<div class="grid">
  <div class="col-12">
    <div class="ml-4 mt-4">
      <h1>TimeTrack</h1>
    </div>
    <div class="w-full flex flex-row align-items-center justify-content-center">
      <div>
      <p-button size="large" *ngIf="startedTimer == false" pRipple icon="pi pi-play" class="p-button-solid" label="Start timer" (click)="startTimeTracker()"></p-button>
      <p-button size="large" *ngIf="startedTimer == true" pRipple icon="pi pi-pause" class="p-button-solid" label="Stop timer" (click)="stopTimer()"></p-button>
      </div>
      <p class="text-6xl font-semibold text-left m-0 p-0 mx-4">{{convertTimeToStringWithSeconds(timer)}}</p>
      <div style="width:10%;">
        <p-dropdown class="p-inputtext-lg" [style]="{width:'100%'}" appendTo="body" [options]="projects" [(ngModel)]="startedData.project" [showClear]="true" placeholder="Select project" [disabled]="projects.length == 0 || startedTimer" (ngModelChange)="projectSubject.next($event)" [filterFields]='["key"]' [filter]="true" filterBy="key">
          <ng-template pTemplate="selectedItem">
            <div class="item flex flex-row justify-content-start align-items-center" *ngIf="startedData.project" >
                {{startedData.project.key}}
            </div>
        </ng-template>
        <ng-template let-project pTemplate="item">
          <div class="flex flex-row justify-content-start align-items-center">
            {{project.key}}
          </div>
        </ng-template>
        </p-dropdown>
      </div>
      <div style="width:22.5%;">
        <p-dropdown appendTo="body" [style]="{width:'100%'}" [options]="tasks" [(ngModel)]="startedData.task" [showClear]="true" placeholder="Select task" [disabled]="tasks.length == 0 || startedTimer" [filterFields]='["name"]' [filter]="true" filterBy="name" class="p-inputtext-lg w-full">
          <ng-template pTemplate="selectedItem">
            <div class="item flex flex-row justify-content-start align-items-center" *ngIf="startedData.task" >
                {{startedData.task.name}}
            </div>
        </ng-template>
        <ng-template let-task pTemplate="item">
          <div class="flex flex-row justify-content-start align-items-center">
            {{task.name}}
          </div>
        </ng-template>
        </p-dropdown>
      </div>
      <div style="width:50%;">
        <input type="text" pInputText id="description" placeholder="Description" [(ngModel)]="startedData.description" [disabled]="startedTimer" class="p-inputtext-lg w-full"/>
      </div>
    </div>
    <div class="card px-4 py-4">
      <div class="flex flex-row justify-content-between align-items-center py-2">
       <p class="m-0 p-0">{{convertDateToString(history.from!)}} - {{convertDateToString(history.to!)}}</p>
       <p class="m-0 p-0">{{convertTimeToString(getHoursAndMinutes(history.time!))}}</p>
      </div>
      <div *ngFor="let timeHistory of history.historyDTOs" class="mb-4">
      <p-table *ngIf="timeHistory.trackedData" [value]="timeHistory.trackedData" styleClass="p-datatable-striped" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="caption">
           <div class="flex flex-row justify-content-between align-items-center">
            <p class="m-0 p-0">{{convertDateToString(timeHistory.dateOfActivity!)}}</p>
            <p class="m-0 p-0">total: {{convertTimeToString(getHoursAndMinutes(timeHistory.time!))}}</p>
           </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th>project key</th>
                <th>task name</th>
                <th>description</th>
                <th>time spent</th>
                <th>total time spent</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-timer>
            <tr>
                <td style="width:10%;">{{ timer.projectKey || '-' }}</td>
                <td style="width:20%;">{{ timer.taskName || '-' }}</td>
                <td style="width:30%;">{{ timer.description || '-'}}</td>
                <td style="width:20%;">{{convertTimeToString(timer.workFrom!)}} - {{convertTimeToString(timer.workTo)}}</td>
                <td style="width:10%;">{{convertTimeToString(getHoursAndMinutes(timer.time!))}}</td>
            </tr>
        </ng-template>
    </p-table>
  </div>
    </div>
  </div>
</div>

